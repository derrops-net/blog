<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Derrops
  
</title>

<meta property="og:type" content="website">
<meta property="og:title" content="Derrops">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Derrops">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Derrick Futschik">
<meta name="twitter:card" content="summary">


  <link rel="alternative" href="/atom.xml" title="Derrops" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">



<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">


<link rel="stylesheet" href="/styles/main.css">







<meta name="generator" content="Hexo 7.2.0"></head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">Derrops</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">
        Derrops
      </a></h1>
    
        <div class="info">
          <div class="content">
            
          </div>
          
            <div class="avatar">
              
                <a href="/about/me"><img src="https://media.licdn.com/dms/image/C5603AQG9FfmyT5LNnA/profile-displayphoto-shrink_800_800/0/1552436367339?e=1720051200&amp;v=beta&amp;t=mNoCMNoIua6BnJKDxCaICzR5EtR3F30Li--s-OoASu0"></a>
                
                    
                      <div class="author">
                        Derrick Futschik
                      </div>
                      
            </div>
            
        </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
                    <li>
                      <a href="/about/me" title="About Me" external="false">About Me</a>
                    </li>
                    
                      
        </ul>
        
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                
              </li>
              
                      
            
                <li class="tag-list-container">
                  <a href="javascript:;">Tag</a>
                  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/" rel="tag">architecture</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es/" rel="tag">es</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensearch/" rel="tag">opensearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensearch-typescript/" rel="tag">opensearch-typescript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/platform/" rel="tag">platform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saas/" rel="tag">saas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software/" rel="tag">software</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">1</span></li></ul>
                </li>
                
                      
            
                  <li class="archive-list-container">
                    <a href="javascript:;">Archive</a>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024</a><span class="archive-list-count">2</span></li></ul>
                  </li>
                  
                      
        </ul>
        
        <ul class="nav">
          
            
                    <li>
                      <a href="/" title="Homepage" external="false">Homepage</a>
                    </li>
                    
                      
            
                    <li>
                      <a href="/archives" title="By Year" external="false">By Year</a>
                    </li>
                    
                      
        </ul>
        
        <ul class="nav">
          
            
                    <li>
                      <a href="/about/videos" title="Favourite Videos" external="false">Favourite Videos</a>
                    </li>
                    
                      
        </ul>
        
        <ul class="nav">
          
            
                    <li>
                      <a href="https://github.com/derrops-net/blog-derrops" title="Blog" target="_blank" rel="noopener">Blog</a>
                    </li>
                    
                      
            
                    <li>
                      <a href="https://github.com/derrops-net" title="Github" target="_blank" rel="noopener">Github</a>
                    </li>
                    
                      
            
                    <li>
                      <a href="https://www.linkedin.com/in/derrick-futschik-38b47162" title="LinkedIn" target="_blank" rel="noopener">LinkedIn</a>
                    </li>
                    
                      
        </ul>
        
          
  </div>
</div>
    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2024/05/01/capability-base-development/index/" >
  Capability Driven Development
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2024/05/01/capability-base-development/index/"><span class="article-date">
  2024-05-01
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/architecture/" rel="tag">architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/platform/" rel="tag">platform</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/saas/" rel="tag">saas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/software/" rel="tag">software</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>The basic premise of Capability Driven Development, (A Derrops Coined Term) is that:</p>
<p><span style="font-size:3em;">“Business Logic Should not Limit Built Capabilities”</span></p>
<h3 id="The-solution"><a href="#The-solution" class="headerlink" title="The solution"></a>The solution</h3><p>Ths situation: Business wants a new feature built, requiring new functionality&#x2F;capability developed currently not existing in the in-house SAAS platform. Based off your experience, what exists currently, and resourcing, you come up with a solution. Your solution happens to contains <em>inherited functionality</em> which you didn’t build, but is simply present in the way the code is developed, and components are wired. You don’t see any issue with this, as there is no need to make use of the extra goodies packaged inside. The solution itself seems intuitive to you, as it seems to just flow with:</p>
<ul>
<li>not requiring invasive changes</li>
<li>exceeds requirements</li>
<li>can fit the solution</li>
</ul>
<h3 id="The-response"><a href="#The-response" class="headerlink" title="The response"></a>The response</h3><p>BUT! When you take it back to the business, they have a different line of thought. They don’t like the approach because it exceeds requirements, it includes functionality which wasn’t requested, you try and bring it back that just because the functionality is there, doesn’t mean you will use it, but the non technical business owners see things differently, and sink your solution.</p>
<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><p>So what happened? Lets try and deconstruct what happens:</p>
<svg viewBox="0 0 2032 450" aria-labelledby="chart-title-mermaid-1716454924927 chart-desc-mermaid-1716454924927" role="img" style="max-width: 2032px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1716454924927"><title id="chart-title-mermaid-1716454924927">Solution</title><desc id="chart-desc-mermaid-1716454924927"></desc><style>#mermaid-1716454924927 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1716454924927 .error-icon{fill:#552222;}#mermaid-1716454924927 .error-text{fill:#552222;stroke:#552222;}#mermaid-1716454924927 .edge-thickness-normal{stroke-width:2px;}#mermaid-1716454924927 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1716454924927 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1716454924927 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1716454924927 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1716454924927 .marker{fill:#333333;stroke:#333333;}#mermaid-1716454924927 .marker.cross{stroke:#333333;}#mermaid-1716454924927 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1716454924927 .pieCircle{stroke:black;stroke-width:2px;opacity:0.7;}#mermaid-1716454924927 .pieTitleText{text-anchor:middle;font-size:25px;fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-1716454924927 .slice{font-family:"trebuchet ms",verdana,arial,sans-serif;fill:#333;font-size:17px;}#mermaid-1716454924927 .legend text{fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:17px;}#mermaid-1716454924927 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g></g><g transform="translate(1016,225)"><path class="pieCircle" fill="#ECECFF" d="M-7.082852093014857e-14,185A185,185,0,0,1,-185,-1.4165704186029714e-13L0,0Z"></path><path class="pieCircle" fill="#ffffde" d="M1.1327982892113017e-14,-185A185,185,0,1,1,-7.082852093014857e-14,185L0,0Z"></path><path class="pieCircle" fill="hsl(80, 100%, 56.2745098039%)" d="M-185,-1.4165704186029714e-13A185,185,0,0,1,1.303290589681841e-13,-185L0,0Z"></path><text style="text-anchor: middle;" class="slice" transform="translate(-65.4073772597557,65.4073772597556)">25%</text><text style="text-anchor: middle;" class="slice" transform="translate(92.5,2.0539125955565396e-14)">50%</text><text style="text-anchor: middle;" class="slice" transform="translate(-65.4073772597556,-65.4073772597557)">25%</text><text class="pieTitleText" y="-200" x="0">Solution</text><g transform="translate(216,-33)" class="legend"><rect style="fill: rgb(236, 236, 255); stroke: rgb(236, 236, 255);" height="18" width="18"></rect><text y="14" x="22">OpenSource</text></g><g transform="translate(216,-11)" class="legend"><rect style="fill: rgb(255, 255, 222); stroke: rgb(255, 255, 222);" height="18" width="18"></rect><text y="14" x="22">Build</text></g><g transform="translate(216,11)" class="legend"><rect style="fill: rgb(181, 255, 32); stroke: rgb(181, 255, 32);" height="18" width="18"></rect><text y="14" x="22">Exists</text></g></g></svg>

<p>But really have </p>
<svg viewBox="0 0 2032 450" aria-labelledby="chart-title-mermaid-1716454925483 chart-desc-mermaid-1716454925483" role="img" style="max-width: 2032px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1716454925483"><title id="chart-title-mermaid-1716454925483">Solution</title><desc id="chart-desc-mermaid-1716454925483"></desc><style>#mermaid-1716454925483 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1716454925483 .error-icon{fill:#552222;}#mermaid-1716454925483 .error-text{fill:#552222;stroke:#552222;}#mermaid-1716454925483 .edge-thickness-normal{stroke-width:2px;}#mermaid-1716454925483 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1716454925483 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1716454925483 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1716454925483 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1716454925483 .marker{fill:#333333;stroke:#333333;}#mermaid-1716454925483 .marker.cross{stroke:#333333;}#mermaid-1716454925483 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1716454925483 .pieCircle{stroke:black;stroke-width:2px;opacity:0.7;}#mermaid-1716454925483 .pieTitleText{text-anchor:middle;font-size:25px;fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-1716454925483 .slice{font-family:"trebuchet ms",verdana,arial,sans-serif;fill:#333;font-size:17px;}#mermaid-1716454925483 .legend text{fill:black;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:17px;}#mermaid-1716454925483 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g></g><g transform="translate(1016,225)"><path class="pieCircle" fill="#ECECFF" d="M108.74027167410753,149.66814395936527A185,185,0,0,1,-108.7402716741075,149.66814395936527L0,0Z"></path><path class="pieCircle" fill="#ffffde" d="M1.1327982892113017e-14,-185A185,185,0,0,1,108.74027167410753,149.66814395936527L0,0Z"></path><path class="pieCircle" fill="hsl(80, 100%, 56.2745098039%)" d="M-108.7402716741075,149.66814395936527A185,185,0,0,1,-175.94545551460342,-57.168143959365246L0,0Z"></path><path class="pieCircle" fill="hsl(240, 100%, 86.2745098039%)" d="M-175.94545551460342,-57.168143959365246A185,185,0,0,1,-3.398394867633905e-14,-185L0,0Z"></path><text style="text-anchor: middle;" class="slice" transform="translate(5.6639914460565085e-15,92.5)">20%</text><text style="text-anchor: middle;" class="slice" transform="translate(87.9727277573017,-28.584071979682633)">40%</text><text style="text-anchor: middle;" class="slice" transform="translate(-87.9727277573017,28.584071979682644)">20%</text><text style="text-anchor: middle;" class="slice" transform="translate(-54.37013583705377,-74.83407197968263)">20%</text><text class="pieTitleText" y="-200" x="0">Solution</text><g transform="translate(216,-44)" class="legend"><rect style="fill: rgb(236, 236, 255); stroke: rgb(236, 236, 255);" height="18" width="18"></rect><text y="14" x="22">OpenSource</text></g><g transform="translate(216,-22)" class="legend"><rect style="fill: rgb(255, 255, 222); stroke: rgb(255, 255, 222);" height="18" width="18"></rect><text y="14" x="22">Build</text></g><g transform="translate(216,0)" class="legend"><rect style="fill: rgb(181, 255, 32); stroke: rgb(181, 255, 32);" height="18" width="18"></rect><text y="14" x="22">Exists</text></g><g transform="translate(216,22)" class="legend"><rect style="fill: rgb(185, 185, 255); stroke: rgb(185, 185, 255);" height="18" width="18"></rect><text y="14" x="22">Requirements</text></g></g></svg>




<svg viewBox="-8 -8 362.390625 300" style="max-width: 362.390625px;" aria-labelledby="chart-title-mermaid-1716454926053 chart-desc-mermaid-1716454926053" role="img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1716454926053"><title id="chart-title-mermaid-1716454926053"></title><desc id="chart-desc-mermaid-1716454926053"></desc><style>#mermaid-1716454926053 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1716454926053 .error-icon{fill:#552222;}#mermaid-1716454926053 .error-text{fill:#552222;stroke:#552222;}#mermaid-1716454926053 .edge-thickness-normal{stroke-width:2px;}#mermaid-1716454926053 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1716454926053 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1716454926053 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1716454926053 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1716454926053 .marker{fill:#333333;stroke:#333333;}#mermaid-1716454926053 .marker.cross{stroke:#333333;}#mermaid-1716454926053 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1716454926053 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1716454926053 .cluster-label text{fill:#333;}#mermaid-1716454926053 .cluster-label span{color:#333;}#mermaid-1716454926053 .label text,#mermaid-1716454926053 span{fill:#333;color:#333;}#mermaid-1716454926053 .node rect,#mermaid-1716454926053 .node circle,#mermaid-1716454926053 .node ellipse,#mermaid-1716454926053 .node polygon,#mermaid-1716454926053 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1716454926053 .node .label{text-align:center;}#mermaid-1716454926053 .node.clickable{cursor:pointer;}#mermaid-1716454926053 .arrowheadPath{fill:#333333;}#mermaid-1716454926053 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1716454926053 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1716454926053 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1716454926053 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1716454926053 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1716454926053 .cluster text{fill:#333;}#mermaid-1716454926053 .cluster span{color:#333;}#mermaid-1716454926053 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1716454926053 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="9" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="0" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-GatherRequirements LE-SolutionDesign" id="L-GatherRequirements-SolutionDesign-0" d="M173.12890625,33.5L173.12890625,37.666666666666664C173.12890625,41.833333333333336,173.12890625,50.166666666666664,173.12890625,58.5C173.12890625,66.83333333333333,173.12890625,75.16666666666667,173.12890625,79.33333333333333L173.12890625,83.5"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SolutionDesign LE-BusinessFeedback" id="L-SolutionDesign-BusinessFeedback-0" d="M193.82349363772454,117L198.9714009481038,121.16666666666667C204.11930825848302,125.33333333333333,214.41512287924152,133.66666666666666,214.41512287924152,142C214.41512287924152,150.33333333333334,204.11930825848302,158.66666666666666,198.9714009481038,162.83333333333334L193.82349363772454,167"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-BusinessFeedback LE-CutSolution" id="L-BusinessFeedback-CutSolution-0" d="M144.1799915793413,200.5L136.97876902445108,204.66666666666666C129.77754646956086,208.83333333333334,115.37510135978043,217.16666666666666,102.96866423403192,225.5C90.56222710828342,233.83333333333334,80.15179796656686,242.16666666666666,74.94658339570857,246.33333333333334L69.7413688248503,250.5"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-CutSolution LE-SolutionDesign" id="L-CutSolution-SolutionDesign-0" d="M44.80443020209581,250.5L43.80642621007984,246.33333333333334C42.80842221806387,242.16666666666666,40.812414234031934,233.83333333333334,39.81441024201597,222.70833333333334C38.81640625,211.58333333333334,38.81640625,197.66666666666666,38.81640625,183.75C38.81640625,169.83333333333334,38.81640625,155.91666666666666,52.22084736776447,144.79166666666666C65.62528848552894,133.66666666666666,92.4341707210579,125.33333333333333,105.83861183882236,121.16666666666667L119.24305295658684,117"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-BusinessFeedback LE-SolutionDesign" id="L-BusinessFeedback-SolutionDesign-0" d="M144.55219638847305,167L137.44356209456086,162.83333333333334C130.3349278006487,158.66666666666666,116.11765921282434,150.33333333333334,116.11765921282434,142C116.11765921282434,133.66666666666666,130.3349278006487,125.33333333333333,137.44356209456086,121.16666666666667L144.55219638847305,117"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-BusinessFeedback LE-BinSolution" id="L-BusinessFeedback-BinSolution-0" d="M227.15658916541918,200.5L240.59631128368264,204.66666666666666C254.03603340194613,208.83333333333334,280.9154776384731,217.16666666666666,293.4497840256986,225.5C305.98409041292416,233.83333333333334,304.1732589508483,242.16666666666666,303.2678432198104,246.33333333333334L302.3624274887725,250.5"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-BinSolution LE-SolutionDesign" id="L-BinSolution-SolutionDesign-0" d="M294.3384753929641,250.5L293.24788313997004,246.33333333333334C292.15729088697606,242.16666666666666,289.976106380988,233.83333333333334,288.885514127994,222.70833333333334C287.794921875,211.58333333333334,287.794921875,197.66666666666666,287.794921875,183.75C287.794921875,169.83333333333334,287.794921875,155.91666666666666,276.3512077407685,144.79166666666666C264.90749360653695,133.66666666666666,242.02006533807386,125.33333333333333,230.57635120384234,121.16666666666667L219.13263706961078,117"></path><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-BusinessFeedback LE-Build" id="L-BusinessFeedback-Build-0" d="M173.50111105913174,200.5L173.59369932010978,204.66666666666666C173.68628758108784,208.83333333333334,173.8714641030439,217.16666666666666,173.96405236402197,225.5C174.056640625,233.83333333333334,174.056640625,242.16666666666666,174.056640625,246.33333333333334L174.056640625,250.5"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(173.12890625, 16.75)" id="flowchart-GatherRequirements-32" class="node default default"><rect height="33.5" width="162.3828125" y="-16.75" x="-81.19140625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-73.69140625, -9.25)" style="" class="label"><foreignObject height="18.5" width="147.3828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">GatherRequirements</span></div></foreignObject></g></g><g transform="translate(173.12890625, 100.25)" id="flowchart-SolutionDesign-33" class="node default default"><rect height="33.5" width="119.328125" y="-16.75" x="-59.6640625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-52.1640625, -9.25)" style="" class="label"><foreignObject height="18.5" width="104.328125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">SolutionDesign</span></div></foreignObject></g></g><g transform="translate(173.12890625, 183.75)" id="flowchart-BusinessFeedback-35" class="node default default"><rect height="33.5" width="142.3359375" y="-16.75" x="-71.16796875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-63.66796875, -9.25)" style="" class="label"><foreignObject height="18.5" width="127.3359375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">BusinessFeedback</span></div></foreignObject></g></g><g transform="translate(48.81640625, 267.25)" id="flowchart-CutSolution-37" class="node default default"><rect height="33.5" width="97.6328125" y="-16.75" x="-48.81640625" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-41.31640625, -9.25)" style="" class="label"><foreignObject height="18.5" width="82.6328125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">CutSolution</span></div></foreignObject></g></g><g transform="translate(298.72265625, 267.25)" id="flowchart-BinSolution-43" class="node default default"><rect height="33.5" width="95.3359375" y="-16.75" x="-47.66796875" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-40.16796875, -9.25)" style="" class="label"><foreignObject height="18.5" width="80.3359375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">BinSolution</span></div></foreignObject></g></g><g transform="translate(174.056640625, 267.25)" id="flowchart-Build-47" class="node default default"><rect height="33.5" width="50.9921875" y="-16.75" x="-25.49609375" ry="0" rx="0" style="" class="basic label-container"></rect><g transform="translate(-17.99609375, -9.25)" style="" class="label"><foreignObject height="18.5" width="35.9921875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Build</span></div></foreignObject></g></g></g></g></g></svg>






<p>When a solution has a bunch of other features bundled outside of the scope of what has been set out, this is a great cause for concern. Why are we going to build or use something which does things outside of what we asked?</p>
<p>The things is, for software developers we do this all the time, in the libraries or technologies we make use of. We usually are using only a small fraction of the library.</p>
<p>Time and time again I find myself in a position whereby I am discussing the approach I plan to take building out a solution to meet a business need, but business beating it back because it is at least perceived to being beyond the scope of what is required, and wanting solution with the business constraints built into the functionality.</p>
<ul>
<li><strong>Capability:</strong> is the what we do</li>
<li><strong>Process:</strong> is the how we do it (–&gt; how a capability is executed)</li>
<li><strong>Service:</strong> is the how we access it (–&gt; how a capability is accessed)</li>
</ul>
<p><img src="/images/posts/capability-base-development/capability-archiecture.png" alt="Capability"></p>
<p>We’ll get to some of these terms shortly, but if we look at Capability it’s “what we do”. We could also change this a little to be “what we can do”, and then in the <code>Service</code> level, we control the access and constrain what we do as just because the business can do something, doesn’t mean it makes sense to for any number of reasons.</p>
<h1 id="The-Case-for-Capability-Driven-Development"><a href="#The-Case-for-Capability-Driven-Development" class="headerlink" title="The Case for Capability Driven Development"></a>The Case for Capability Driven Development</h1><h2 id="SRP"><a href="#SRP" class="headerlink" title="SRP"></a>SRP</h2><p>But just because it doesn’t make sense to do something, doesn’t mean we should put artificial constraints on our capability. I put forward a number of reasons this is the case, probably the most easiest way to make the case for this is the old: Single-responsibility principal <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Single-responsibility_principle">SRP</a>.</p>
<p>Within an application we have <em>Business Logic</em>. Based on <strong>SRP</strong>, <em>Business Logic|Rules</em> should not be scattered all over the codebase. But rather reside in the Service Layer, which is the the interface to the business, and speaks the common Domain Specific Language.</p>
<h2 id="Encapsulation"><a href="#Encapsulation" class="headerlink" title="Encapsulation"></a>Encapsulation</h2><p>The other reason is that if we encapsulate the <em>BL</em> in the Service Layer, then when the <em>BL</em> changes, we only need to change the Service Layer, and we don’t need to touch any lower-level libraries. We can always get a good feel for how our code architecture performs when we need to change it. If some high level <em>BL</em> were to change, but we still needed for the most part, the same capabilities we had before, but we had to change lower level software components that dealt with uploading files or saving information to a database, that would be a sign that how we have structured our code in a way in which <em>BL</em> is not encapsulated, and other un-related functionality is being needed to change.</p>
<h2 id="Reusability-Example"><a href="#Reusability-Example" class="headerlink" title="Reusability Example"></a>Reusability Example</h2><p>When we have business logic and code in the one place, we cannot reuse that functionality for another context with different business logic. Let’s look at some concrete example with a Spring <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html">JpaRepository</a>. Let’s assume we have a <code>ComplaintEntity</code> representing a complaint by customers for our business. Now let’s say I have a business rule which is that a complaint cannot be deleted within the first 7 days it was created.</p>
<p>Within the <code>ComplaintRepository</code>, we can override the delete method with our new rule:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">    <span class="comment">// TODO check current age of complaint</span></span><br><span class="line">    <span class="comment">// if age &lt; 7 days through an exception</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Funnily enough there is a similar question on StackOverflow <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13036159/spring-data-override-save-method">Spring Data: Override save method</a> and lets look at what the OP ends up doing: 😉<br><img src="/images/posts/capability-base-development/override-delete-method-post.png" alt="SO"></p>
<p>Let’s assume we do successfully provide our own <code>default</code> implementation of this method, and then the business comes along and says to us, we want to allow users to delete their own complaints if they accept one of our explanations.</p>
<p>Well we’d actually lost the normal <code>delete</code> capability from our Repository because we baked in a business constraint into the functionality. The same thing could have also been achieved by annotating a method at the Entity level with: <code>@PreRemove</code> and doing the check there. If we’d done that then we’d be in real trouble. As we couldn’t even implement a new delete method it would still trigger this method, and we’d have to undo our other code and implement both business processes again.</p>
<p>Had we done this in the service layer, firstly it’s easy to then find the business logic already present in the application if Capability Driven Development is followed, and then secondly we could add the appropriate logic there which. We can either have 2 different methods each with different security controls placed on it, or a single method with the 2 rules together in the one location with the one method.</p>
<p>Stylistic I would go for having one method, as developers don’t need to sort through multiple use-cases. There are other reasons for also keeping the <em>BR</em> separate, such as when testing.</p>
<h2 id="Checklist"><a href="#Checklist" class="headerlink" title="Checklist"></a>Checklist</h2><p>An easy way to make sure you are following this is to:</p>
<ol>
<li>Make sure Services contain all the business logic, but at the same time, services, just like non-technical business people do not deal with lower-level technical details</li>
</ol>
<ul>
<li>A capability is anything that is not a service. It should not have any business logic or constraints applied to it.</li>
</ul>
<h2 id="Business-Rules-should-Guide-Capabilities-Architecture"><a href="#Business-Rules-should-Guide-Capabilities-Architecture" class="headerlink" title="Business Rules should Guide Capabilities Architecture"></a>Business Rules should Guide Capabilities Architecture</h2><p>The biggest conflict I see between business and the software development team is:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">What to Build?</span><br></pre></td></tr></table></figure>

<h2 id="The-intuitive-interpretation"><a href="#The-intuitive-interpretation" class="headerlink" title="The intuitive interpretation"></a>The intuitive interpretation</h2><p>It’s only occurred to me recently that I view this question differently than most people. Most people would look at this question as the same as:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">What does the business need?</span><br></pre></td></tr></table></figure>

<h3 id="What-should-happen"><a href="#What-should-happen" class="headerlink" title="What should happen"></a>What should happen</h3><p>Let’s build what the business is telling us to build right now. That seems to be the most intuitive way to respond to this request, and what most people do. An initial MVP product is converged on, tasks are created, and Developers start to update and create new services.</p>
<h3 id="What-shouldn’t-happen"><a href="#What-shouldn’t-happen" class="headerlink" title="What shouldn’t happen"></a>What shouldn’t happen</h3><p>Developers should not forsake <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it">YAGNI</a>, and cater for extra requirements the business will never need. Nor should they go off and build abstract platforms and frameworks just because the given immediate business need is not an air tight fit to existing availabile opensource solutions.</p>
<p>After all, as long as developers are followings some best practices, the development effort should not be hindered, and the system can be re-architecture later if need be, which is acceptable and common place and businesses grow, teams expand etc.</p>
<h2 id="The-un-intuitive-interpretation"><a href="#The-un-intuitive-interpretation" class="headerlink" title="The un-intuitive interpretation"></a>The un-intuitive interpretation</h2><p>The problem with <code>What does the business need?</code> is that sometimes this question is too direct, and we don’t actually know. So what happens is the business makes a <strong>business decision</strong>. It decides what it needs. But we don’t really decide what we need do we? We just inherently need them. It’s an important destination between the two. What we end up deciding on is not necessarily what we need. It’s easy for a farming business to know it needs a new tractor, or a restaurant it needs a new fridge. But it’s really hard to know what software to develop because we can’t see all the ramifications of the changes we are going to make.</p>
<p>What about instead we changed the question of <code>What to Build?</code> to</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">What Capabilities do we need?</span><br></pre></td></tr></table></figure>

<p>I did find one post about these distinctions which excited me that others are thinking this way <a target="_blank" rel="noopener" href="https://www.linkedin.com/pulse/service-vs-capability-process-daniel-dekkers/">Service vs. Capability vs. Process</a> which the author gives great definitions:</p>
<ul>
<li><strong>Capability:</strong> is the what we do</li>
<li><strong>Process:</strong> is the how we do it (–&gt; how a capability is executed)</li>
<li><strong>Service:</strong> is the how we access it (–&gt; how a capability is accessed)</li>
</ul>
<p>As far as developers are concerned:</p>
<ul>
<li>Capability Does not contain business logic</li>
<li>Service contains business logic</li>
</ul>
<p>In a Spring Application for example we could consider a <code>Repository</code> a capability. But as mentioned the Capability should be the what we do, and the service control how all these capabilities are interacting and playing together. But back to the question interpretation, if we develop a capability, we can break up what the business is telling us into what is purely a business decision, which could be a limitation on functionality&#x2F;capability, it is usually a constraint. And then, the functionality&#x2F;capability itself. In this way, we free ourselves of the chains of business decisions, and are free to develop great capabilities, and then bake those constraints into the <code>Service</code> layer.</p>
<p>Let’s take a <code>SpringJPARepository</code> as an example. Now the business might tell us that we are never allowed to delete a row in a database. Does that mean we can’t use a default interface as it has all these methods we cannot use? Of course not we just don’t need to make use of that capability, it’s there if we need it, but there is no need to spend extra effort to enforce a constraint at the capability level. Instead this constraint can be in the Service level, were delete is just not callable.</p>
<p>We can also ask ourselves why there is no reusable Repository without the delete functionality? Well obviously because that is not as useful, but it’s not as useful because a constraint is baked into it. Let’s say we change things a little and have a business rule such as</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cannot delete before 14 days have passed</span><br></pre></td></tr></table></figure>
<p>If we put this constraint into our <code>Repository</code> layer, and override the delete method, this again is a constraint going into the Repository Layer. This constraint should go into our <code>Service</code> layer as this is a business decision. That’s not to say we might develop methods in the repository Layer to help meet business requirements. But we don’t hinder a capability and change the delete function in the repository, because as soon as we do need to delete a record with less than 14 days, say a super admin. We will need to alter our Repository again, as we baked the 14 day constraint into the delete method.</p>
<h2 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h2><p><a target="_blank" rel="noopener" href="https://www.linkedin.com/pulse/service-vs-capability-process-daniel-dekkers/">Service vs. Capability vs. Process</a><br><a target="_blank" rel="noopener" href="https://medium.com/@myroslavazel/business-rule-and-business-requirement-what-is-the-difference-320bbc74fc5e">Business Rule and Business Requirement — what is the difference?</a></p>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2024/05/01/denesting-opensearch/" >
  De-nesting Opensearch
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2024/05/01/denesting-opensearch/"><span class="article-date">
  2024-05-01
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es/" rel="tag">es</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/opensearch/" rel="tag">opensearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/opensearch-typescript/" rel="tag">opensearch-typescript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p><img src="/images/bees-nest.jpg" alt="Nest"><br>ES is a powerful tool for searching through documents, providing developers with powerful abstractions to construct complex queries, often having a deeply nested structure, which can become deeply nested at times. Is this nest more like a bee nest leading to stings? Or a comfy bird nest? Lets do some examples and see where we go. NOTE examples used will make use of the sample data available at : <code>/_dashboards/app/home#/tutorial_directory</code>.</p>
<h2 id="Aggs-Aggregations"><a href="#Aggs-Aggregations" class="headerlink" title="Aggs - Aggregations"></a>Aggs - Aggregations</h2><p>Using <code>opensearch_dashboards_sample_data_flights</code>, lets derive a histogram of the average by month, for each country. Thi query is as follows:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST opensearch_dashboards_sample_data_flights/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;country&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DestCountry&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;histogram&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;date_histogram&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timestamp&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;week&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avg_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AvgTicketPrice&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>And the returned JSON is as follows:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gte&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;aggregations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;country&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;doc_count_error_upper_bound&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sum_other_doc_count&quot;</span><span class="punctuation">:</span> <span class="number">3187</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IT&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">2371</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;histogram&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">              <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;key_as_string&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-04-15T00:00:00.000Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="number">1713139200000</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;doc_count&quot;</span><span class="punctuation">:</span> <span class="number">399</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avg_price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">579.1077163619804</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              ...</span><br></pre></td></tr></table></figure>

<p> Without the guard-rails of a type-system, some of us&#x2F;most of us (this being true of myself), if asked would have a very hard time parsing this response to iterate and drill-down to the <code>value</code> giving the actual value for a given month. Likewise writing the aggs query, remembering the correct field names exactly, and the exact structure is difficult to say the least, and frankly, annoying and frustrating. You’re left reverting to the Dev Tools tab in the ES console to write you queries and bring them back into your IDE as a work around for lack of IDE support. But there is no option for parsing the response. Closest thing is to copy output JSON ans use a tool such as <a target="_blank" rel="noopener" href="https://quicktype.io/">quicktype</a> to generate your typescript types with something like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quicktype <span class="built_in">source</span>/_posts/flights-aggs.json -o <span class="built_in">source</span>/_posts/flights-aggs.ts</span><br></pre></td></tr></table></figure>

<p>This will generate types for your response:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">FlightsAggs</span> &#123;</span><br><span class="line">    <span class="attr">took</span>:         <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">timed_out</span>:    <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">_shards</span>:      <span class="title class_">Shards</span>;</span><br><span class="line">    <span class="attr">hits</span>:         <span class="title class_">Hits</span>;</span><br><span class="line">    <span class="attr">aggregations</span>: <span class="title class_">Aggregations</span>;</span><br><span class="line">&#125;</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<p>Whilst this makes things bearable for us, it’s still a very discontinuous workflow, of navigating between Dev Tools, bash and your IDE, and maybe even the Discover Tab to check those pesky field names. Wouldn’t it be nice if the IDE did all the heavy lifting for you instead? Wouldn’t it be great if you could write the same JSON in the Dev Tools as in your <code>typescript</code> project? We’ll now you can with <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/opensearch-typescript">opensearch-typescript</a>. With this library, you only need to use a tool like <code>quicktype</code> once to generate the type of your Document in your index, and then you can stay happily safe and home in your IDE.</p>
<h2 id="Opensearch-Typescript"><a href="#Opensearch-Typescript" class="headerlink" title="Opensearch-Typescript"></a>Opensearch-Typescript</h2><p>This library can be used to empower your IDE with types that provide you with effective guard-rails for ES. Let’s create a unique type for our aggregation from earlier:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">AvgByMonthForEachCountrySearch</span> = <span class="title class_">Search</span>&lt;<span class="title class_">Flight</span>, &#123;</span><br><span class="line">    <span class="attr">country</span>: &#123;</span><br><span class="line">        <span class="attr">agg</span>: <span class="string">&quot;terms&quot;</span>,</span><br><span class="line">        <span class="attr">aggs</span>: &#123;</span><br><span class="line">            <span class="attr">histogram</span>: &#123;</span><br><span class="line">                <span class="attr">agg</span>: <span class="string">&quot;date_histogram&quot;</span>,</span><br><span class="line">                <span class="attr">aggs</span>: &#123;</span><br><span class="line">                    <span class="attr">avg_price</span>: &#123;</span><br><span class="line">                        <span class="attr">agg</span>: <span class="string">&quot;avg&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&gt;</span><br></pre></td></tr></table></figure>
<p>The combination of the <code>Flight</code> type with the type defined with the brackets: <code>&#123; country ...&#125;</code> is enough to create guard rails for the query, and the response. From the <code>Flight</code> type, we know all the <code>Fields</code> in our document, and so the IDE is able to give us back our old friend: auto-complete.<br><img src="/images/posts/denesting-opensearch/AverageTicketPrice.png" alt="AverageTicketPrice"></p>
<p>But the best news is yet to come, we can now parse that nested JSON response with no problem thanks to the compiler. Using the custom client: <code>TypescriptOSProxyClient</code>. We can get a strongly-typed response from ES:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> tsClient.<span class="title function_">searchTS</span>(&#123;body : search, index : <span class="string">&quot;opensearch_dashboards_sample_data_flights&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">aggregations</span>.<span class="property">country</span>.<span class="property">buckets</span>.<span class="title function_">flatMap</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">histogram</span>.<span class="property">buckets</span>.<span class="title function_">flatMap</span>(<span class="function"><span class="params">h</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">country</span>: c.<span class="property">key</span>,</span><br><span class="line">    <span class="attr">avg_price</span>: h.<span class="property">avg_price</span>.<span class="property">value</span>,</span><br><span class="line">    <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(h.<span class="property">key_as_string</span>)</span><br><span class="line">&#125;))))</span><br></pre></td></tr></table></figure>

<p>With all of this code being type-safe:<br><img src="/images/posts/denesting-opensearch/county.png" alt="county"></p>
<p>Checkout my package on <a target="_blank" rel="noopener" href="https://github.com/derrops-net/opensearch-typescript#readme">github</a>, all feedback is welcome.</p>
<p>Derrops.</p>

        
      </div>
    </div>

  
    </div>
  






          <div class="main-footer">
  
    © 2024 Derrops - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  
<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


  
<link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">

  
<link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">


  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  
<script src="/PhotoSwipe/photoswipe.js"></script>

  
<script src="/PhotoSwipe/photoswipe-ui-default.js"></script>




<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>


<script src="/scripts/main.js"></script>


</body>
</html>
